 CREATE TABLE FROM STAGE_layer:
	
create table data_repurchase_stg.employee_stage(
SNAPSHOTDATE STRING,
EMPLID STRING,
EMPL_CLASS STRING,
POSITION_NBR STRING,
POSITION_DESCRIPTION STRING,
DEPTID STRING,
DIRECOTRATE_DESCRIPTION STRING,
DEPARTMENT_DESCRIPTION STRING,
ACCT_CD STRING,
LOCATION STRING,
ORG_LEVEL STRING,
L1_EMPLID STRING,
L1_NAME STRING,
L1_POSITION_NBR STRING,
L1_POSITION_NAME STRING,
L2_EMPLID STRING,
L2_NAME STRING,
L2_POSITION_NBR STRING,
L2_POSITION_NAME STRING,
L3_EMPLID STRING,
L3_NAME STRING,
L3_POSITION_NBR STRING,
L3_POSITION_NAME STRING,
LEVEL STRING,
HIRE_DATE STRING,
REHIRE_DT STRING,
SERVICE_DT STRING,
SERVICE_DATE STRING);


-------------------------------------------------------------------------------TO LOAD DATA FROM STAGE TO HISTORY TABLE:
LOAD DATE FROM BUCKET TO STAGE_TABLE:

bq load --source_format=CSV --skip_leading_rows=1 data_repurchase_stg.employee_stage C:\Users\balaj\OneDrive\Desktop\employee_data.csv
----------------------------------------------------------


CEATE HISTORY_TABLE WITH SCHEMA:

create table data_repurchase_hist.employee_history(
SNAPSHOTDATE DATE,
EMPLID	INT64,
EMPL_CLASS	STRING,
POSITION_NBR	INT64,
POSITION_DESCRIPTION	STRING,
DEPTID	STRING,
DIRECOTRATE_DESCRIPTION	STRING,
DEPARTMENT_DESCRIPTION	STRING,
ACCT_CD	STRING,
LOCATION	STRING,
ORG_LEVEL	INT64,
L1_EMPLID	STRING,
L1_NAME	STRING,
L1_POSITION_NBR	STRING,
L1_POSITION_NAME	STRING,
L2_EMPLID	STRING,
L2_NAME	STRING,
L2_POSITION_NBR	STRING,
L2_POSITION_NAME	STRING,
L3_EMPLID	STRING,
L3_NAME	STRING,
L3_POSITION_NBR	STRING,
L3_POSITION_NAME	STRING,
LEVEL	INT64,
HIRE_DATE	DATE,
REHIRE_DT	DATE,
SERVICE_DT	DATE,
REAL_SERVICE_DATE	DATE,
LAST_UPDATED	TIMESTAMP,
CUNTRY_CODE	STRING,
STATE_CODE	STRING)


------------------------------------------

INSERT TO ADD NEW COLOUMNS IN HISTORY TABLE:


insert into data_repurchase_hist.history_table_dev
select SNAPSHOTDATE,
EMPLID,
EMPL_CLASS,
POSITION_NBR,
POSITION_DESCRIPTION,
DEPTID,
DIRECOTRATE_DESCRIPTION,
DEPARTMENT_DESCRIPTION,
ACCT_CD,
LOCATION,
ORG_LEVEL,
L1_EMPLID,
L1_NAME,
L1_POSITION_NBR,
L1_POSITION_NAME,
L2_EMPLID,
L2_NAME,
L2_POSITION_NBR,
L2_POSITION_NAME,
L3_EMPLID,
L3_NAME,
L3_POSITION_NBR,
L3_POSITION_NAME,
LEVEL,
HIRE_DATE,
REHIRE_DT,
SERVICE_DT,
SERVICE_DATE
from data_repurchase_stg.employee_stage

-----------------------------------------------
  
INSERT COULUMNS USING CASTING FUNCTIONS AND LOAD DATA FROM STAGE TO HISTORY:  
  
  INSERT INTO
  data_repurchase_hist.employee_history
SELECT
  PARSE_DATE('%d-%m-%Y',SNAPSHOTDATE),
  SAFE_CAST(EMPLID AS INT64),
  EMPL_CLASS STRING,
  CAST(POSITION_NBR AS INT64),
  POSITION_DESCRIPTION STRING,
  DEPTID STRING,
  DIRECOTRATE_DESCRIPTION STRING,
  DEPARTMENT_DESCRIPTION STRING,
  ACCT_CD STRING,
  LOCATION STRING,
  CAST(ORG_LEVEL AS INT64),
  L1_EMPLID STRING,
  L1_NAME STRING,
  L1_POSITION_NBR STRING,
  L1_POSITION_NAME STRING,
  L2_EMPLID STRING,
  L2_NAME STRING,
  L2_POSITION_NBR STRING,
  L2_POSITION_NAME STRING,
 L3_EMPLID STRING,
  L3_NAME STRING,
  L3_POSITION_NBR STRING,
  L3_POSITION_NAME STRING,
  CAST(LEVEL AS INT64),
  CAST(HIRE_DATE AS date),
  PARSE_DATE('%d-%b',REHIRE_DT),
  CAST(SERVICE_DT AS date),
  current_date AS REAL_SERVICE_DATE,
  current_timestamp AS LAST_UPDATED,
  "IND" AS CUNTRY_CODE,
  "AP" STATE_CODE
FROM
  data_repurchase_stg.employee_stage
  
---------------------------------------------
  CREATE VIEW_TABLE: 
  
 CREATE VIEW
  data_repurchase_hist.myview AS
SELECT
  *
FROM
  data_repurchase_hist.employee_history

----------------------------------------------

CREATE AUDIT TABLE:


 CREATE TABLE
  audit_data_repur_dev.employee_data_dev( dataset_name string,
    table_name string,
    audit_table timestamp,
    total_records_processed int64,
    auditor string )

-------------------------------------------

DO PARTITONING IN HISTORY_TABLE:


 create table data_repurchase_partition_table1(
SNAPSHOTDATE DATE,
EMPLID	INT64,
EMPL_CLASS	STRING,
POSITION_NBR	INT64,
POSITION_DESCRIPTION	STRING,
DEPTID	STRING,
DIRECOTRATE_DESCRIPTION	STRING,
DEPARTMENT_DESCRIPTION	STRING,
ACCT_CD	STRING,
LOCATION	STRING,
ORG_LEVEL	INT64,
L1_EMPLID	STRING,
L1_NAME	STRING,
L1_POSITION_NBR	STRING,
L1_POSITION_NAME	STRING,
L2_EMPLID	STRING,
L2_NAME	STRING,
L2_POSITION_NBR	STRING,
L2_POSITION_NAME	STRING,
L3_EMPLID	STRING,
L3_NAME	STRING,
L3_POSITION_NBR	STRING,
L3_POSITION_NAME	STRING,
LEVEL	INT64,
HIRE_DATE	DATE,
REHIRE_DT	DATE,
SERVICE_DT	DATE,
REAL_SERVICE_DATE	DATE,
LAST_UPDATED	TIMESTAMP,
CUNTRY_CODE	STRING,
STATE_CODE	STRING)
PARTITION BY
TIMESTAMP_trunc(last_updated,day);